{% extends 'base.html' %}
{% block content %}
<section class="grid lg:grid-cols-3 gap-8">
  <div class="lg:col-span-2 card p-8">
    <div class="flex items-start gap-6">
      <div class="flex-1">
        <h1 class="text-3xl font-extrabold">Showcase — Phones, Graphics & Videos</h1>
        <p class="mt-3 muted">High-quality catalog for your customers. Manage everything from the admin dashboard.</p>

        <div class="mt-6 flex gap-3 flex-wrap">
          <a href="/phones" class="px-4 py-2 rounded-lg bg-navy-800 text-accent font-semibold">Browse Phones</a>
          <a href="/designs" class="px-4 py-2 rounded-lg border border-white/6">View Designs</a>
          <a href="/videos" class="px-4 py-2 rounded-lg border border-white/6">Watch Videos</a>
        </div>

        <div class="mt-8 grid sm:grid-cols-2 gap-4">
          {% for p in phones[:4] %}
          <div class="flex gap-4 items-center p-3 rounded-lg border border-white/6">
            <div class="h-20 w-28 rounded-lg overflow-hidden">
              {% if p.image %}
                {% if p.image.startswith('http') %}
                  <img src="{{ p.image }}" alt="{{ p.name }}" class="h-full w-full object-cover" loading="lazy">
                {% else %}
                  <img src="/static/uploads/{{ p.image }}" alt="{{ p.name }}" class="h-full w-full object-cover" loading="lazy">
                {% endif %}
              {% else %}
                <div class="h-full w-full bg-navy-800 flex items-center justify-center muted">No image</div>
              {% endif %}
            </div>

            <div class="flex-1">
              <div class="font-semibold">{{ p.name }}</div>
              <div class="muted text-sm">₦{{ '{:,.2f}'.format(p.price) }}</div>
            </div>
            <div>
              <span class="badge">₦{{ '{:,.0f}'.format(p.price) }}</span>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <div style="width:240px;">
        <div class="card p-4">
          <div class="text-sm muted">Quick stats</div>
          <div class="mt-3">
            <div class="flex items-center justify-between"><div class="muted text-sm">Phones</div><div class="font-semibold">{{ phones|length }}</div></div>
            <div class="flex items-center justify-between mt-2"><div class="muted text-sm">Designs</div><div class="font-semibold">{{ designs|length }}</div></div>
            <div class="flex items-center justify-between mt-2"><div class="muted text-sm">Videos</div><div class="font-semibold">{{ videos|length }}</div></div>
          </div>
        </div>

        <div class="mt-4 card p-4">
          <div class="text-sm muted">Admin</div>
          <a href="/admin" class="mt-3 inline-block px-3 py-2 rounded-lg bg-navy-800 text-accent">Open dashboard</a>
        </div>
      </div>
    </div>
  </div>

  <aside class="space-y-6">
    <div class="card p-4">
      <div class="flex items-center justify-between">
        <div class="font-semibold">Latest Designs</div>
        <a class="muted text-sm" href="/designs">See all</a>
      </div>
      <div class="mt-3 grid gap-3">
        {% for d in designs[:3] %}
        <div class="flex items-center gap-3 p-2 border rounded">
          <div class="h-14 w-14 rounded overflow-hidden">
            {% if d.image %}
              {% if d.image.startswith('http') %}
                <img src="{{ d.image }}" alt="{{ d.title }}" class="h-full w-full object-cover" loading="lazy">
              {% else %}
                <img src="/static/uploads/{{ d.image }}" alt="{{ d.title }}" class="h-full w-full object-cover" loading="lazy">
              {% endif %}
            {% else %}
              <div class="h-full w-full bg-navy-800 flex items-center justify-center muted">No preview</div>
            {% endif %}
          </div>
          <div class="flex-1">
            <div class="font-medium">{{ d.title }}</div>
            <div class="muted text-sm">{% if d.is_free %}Free{% else %}₦{{ '{:,.0f}'.format(d.price) }}{% endif %}</div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="card p-4">
      <div class="flex items-center justify-between">
        <div class="font-semibold">Recent Videos</div>
        <a class="muted text-sm" href="/videos">See all</a>
      </div>
      <div class="mt-3 space-y-3">
        {% for v in videos[:2] %}
        <div class="p-2 border rounded flex items-center gap-3">
          <div class="h-14 w-24 rounded overflow-hidden bg-navy-800">
            {% if v.poster %}
              {% if v.poster.startswith('http') %}
                <img src="{{ v.poster }}" alt="{{ v.title }}" class="h-full w-full object-cover" loading="lazy">
              {% else %}
                <img src="/static/uploads/{{ v.poster }}" alt="{{ v.title }}" class="h-full w-full object-cover" loading="lazy">
              {% endif %}
            {% else %}
              <div class="h-full w-full flex items-center justify-center muted">Video</div>
            {% endif %}
          </div>
          <div class="flex-1">
            <div class="font-medium">{{ v.title }}</div>
            <div class="muted text-sm">Uploaded: {{ v.created_at.split('T')[0] if v.created_at }}</div>
          </div>
          <div>
            <button class="px-3 py-1 rounded border play-btn" data-src="{{ v.filename if v.filename.startswith('http') else '/static/uploads/' + v.filename }}" data-poster="{{ v.poster }}" data-title="{{ v.title }}">Play</button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </aside>
</section>

<!-- reuse video modal from videos.html if present globally -->
<div id="videoModal" class="fixed inset-0 hidden items-center justify-center z-50 bg-black/70 p-4">
  <div class="max-w-4xl w-full bg-navy-900 rounded-lg overflow-hidden">
    <div class="flex items-center justify-between p-3 border-b border-white/5">
      <div id="vTitle" class="font-semibold"></div>
      <button id="closePlayer" class="px-3 py-1 rounded border">Close</button>
    </div>
    <div class="p-4 bg-black">
      <video id="player" controls playsinline class="w-full h-[480px] bg-black"></video>
    </div>
  </div>
</div>

<script>
  // global play handlers
  document.querySelectorAll('.play-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const src = btn.getAttribute('data-src');
      const poster = btn.getAttribute('data-poster');
      const title = btn.getAttribute('data-title') || '';
      const modal = document.getElementById('videoModal');
      const player = document.getElementById('player');
      document.getElementById('vTitle').textContent = title;
      player.src = src;
      if(poster){
        player.setAttribute('poster', poster.startsWith('http') ? poster : poster.startsWith('/') ? poster : '/static/uploads/'+poster);
      } else {
        player.removeAttribute('poster');
      }
      modal.classList.remove('hidden'); modal.classList.add('flex');
      player.play().catch(()=>{});
    });
  });
  document.getElementById('closePlayer')?.addEventListener('click', ()=>{
    const modal = document.getElementById('videoModal');
    const player = document.getElementById('player');
    player.pause(); player.src = '';
    modal.classList.remove('flex'); modal.classList.add('hidden');
  });
  document.getElementById('videoModal')?.addEventListener('click', (e)=>{ if(e.target.id==='videoModal') document.getElementById('closePlayer').click(); });
</script>
{% endblock %}
